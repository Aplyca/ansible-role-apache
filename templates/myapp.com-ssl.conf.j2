 # {{ ansible_managed }}

<VirtualHost *:{{ item['port']|default('443') }}>
	{% if item['DocumentRoot'] is defined %}
    DocumentRoot {{ item['DocumentRoot']|default('/var/www/html') }}
	{% endif %}

    ServerName {{ item['ServerName']|default('myapp.com') }}
	{% if item['ServerAlias'] is defined %}
    {% for serveralias in item['ServerAlias'] %}
    ServerAlias {{ serveralias }}
    {% endfor %}
	{% endif %}

    SSLEngine on
    <Directory ./>
        SSLRequireSSL
    </Directory>

    {% if item['SSLCertificateFile'] is defined %}
        SSLCertificateFile {{ item['SSLCertificateFile'] }}
    {% endif %}
    {% if item['SSLCertificateKeyFile'] is defined %}
        SSLCertificateKeyFile {{ item['SSLCertificateKeyFile'] }}
    {% endif %}
    {% if item['SSLCertificateChainFile'] is defined %}
        SSLCertificateChainFile {{ item['SSLCertificateChainFile'] }}
    {% endif %}

    CustomLog {{ item.ErrorLog | default(apache.logs_dir ~ "/" ~ item.ServerName ~ "_access.log" ) }} combined
    ErrorLog {{ item.ErrorLog | default(apache.logs_dir ~ "/" ~ item.ServerName ~ "_error.log" ) }}

    {% if item['IncludeOptional'] is defined %}
        {% for include in item['IncludeOptional'] %}
            {% if confd.stat is defined and confd.stat.isdir is defined and confd.stat.isdir == true %}Include{% else %}IncludeOptional{% endif %} "{{ include }}"
        {% endfor %}
    {% endif %}
</VirtualHost>
